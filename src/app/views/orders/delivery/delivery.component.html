<app-page-title title="Livraison" subTitle="Suivi livraison" />
<div  *ngIf="order">


<div class="  card mt-1" *ngIf="order && !loading && order.status=='En préparation' || order.status=='Livré'">
  <div class="card-header">
    <h2 class="mb-4">Commande #{{ order.id }}</h2>
  </div>

<div class="card-body">
  <!-- Détails produits -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">📦 Produits commandés</div>
    <div class="card-body">
      <ul class="list-group list-group-flush">
        <li *ngFor="let item of order.items" class="list-group-item d-flex justify-content-between align-items-center">
          {{ item.product }} (x{{ item.quantity }})
          <span>{{ item.product_price | number: '1.2-2' }} {{ currency }}</span>
        </li>
        <li class="list-group-item text-end">
          <strong>Total : {{ order.total | number: '1.2-2' }} {{ currency }}</strong>
        </li>
      </ul>
    </div>
    <div class="card-footer" *ngIf="!loading && order.status=='Livré'">
      <a [routerLink]="['/orders', order.id, 'issue']" class="btn btn-outline-danger btn-sm">
        Signaler un problème
      </a>
    </div>
  </div>

  <!-- Adresse livraison -->
  <div class="card mb-4">
    <div class="card-header bg-success text-white">🚚 Adresse de livraison</div>
    <div class="card-body">
      <p class="mb-1">{{ order.delivery?.address }}</p>
      <p><strong>Statut : </strong>{{ order?.status }}</p>
      <p><strong>Livré le : </strong>{{ order.delivery?.delivered_at || 'En cours...' }}</p>
    </div>
  </div>

  <!-- Suivi -->
  <div class="card mb-4">
    <div class="card-header bg-info text-white">📍 Suivi de la commande</div>
    <div class="card-body">
      <div class="progress" style="height: 25px;">
        <div class="progress-bar progress-bar-striped progress-bar-animated bg-warning"
             role="progressbar"
             [style.width]="getTrackingProgress(order.delivery?.status)">
          {{ order.delivery?.status }}
        </div>
      </div>
    </div>
  </div>

  <!-- Litiges -->
  <div *ngIf="order.litiges?.length" class="card mb-4 border-danger">
    <div class="card-header bg-danger text-white">⚠️ Litiges</div>


    <ul class="list-group list-group-flush">
      <li *ngFor="let l of order.litiges" class="list-group-item">
        <strong>Motif : </strong>{{ l.motif }}<br />
        <strong>Statut : </strong>{{ l.status }}<br />
        <strong>Commentaire : </strong>{{ l.commentaire }}
      </li>
    </ul>
  </div>
</div>

</div>
</div>
<!-- Loading -->
<div *ngIf="loading" class="text-center my-5">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Chargement...</span>
  </div>
  <p class="mt-3">Chargement des détails de la commande...</p>
</div>
